<!doctype html>
<html lang="es">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Librería de la semana - Pavlova | David Francos
</title>
  <link rel="canonical" href="./dataclasses.html">
  <link href="https://fonts.googleapis.com/css?family=Advent+Pro" rel="stylesheet">


    <link rel="apple-touch-icon" href="./apple-touch-icon.png" sizes="180x180">
    <link rel="icon" type="image/png" href="./favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="./favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#333333">

  <link href="https://fonts.googleapis.com/css?family=Advent+Pro|Roboto" rel="stylesheet">
  <link rel="stylesheet" href="./theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="./theme/css/font-awesome.min.css">
  <link rel="stylesheet" href="./theme/css/pygments/vim.min.css">
  <link rel="stylesheet" href="./theme/css/theme.css">


  
  <meta name="description" content="Con la salida de python3.7, hemos visto la inclusion de las dataclasses en la libreria standard. Las dataclasses son una forma ordenada, simple y pythonica de implementar clases que trabajen con datos, al estilo modelos.">
  <script>
    (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o);
      a.async = 1;
      a.src = g;
      m = s.getElementsByTagName(o)[0];
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-53006258-1', 'auto');
    ga('send', 'pageview');
  </script>


</head>

<body>
  <header class="header">
<div class="container" style="max-width:100%; margin-top:30px">
<div class="row align-items-center justify-content-center">
  <div class="col-sm-4 text-center">
    <a href="./" class=brand>
      <img class="img img-responsive text-center" src=./theme/images/logo.png alt="David Francos">
    </a>
  </div>
</div>
<div class="row align-items-center justify-content-center">
  <div class="col-sm-12 text-center">
      <p class="text-muted">Tecnología y patitos de goma</p>
    <ul id="menu-menu-1" class="list-inline menu">
      <li class="list-inline-item"><a href="/">Inicio</a></li>
        <li class="list-inline-item"><a href="/category/python.html">Python</a></li>
        <li class="list-inline-item"><a href="/category/tecnologia.html">Tecnologia</a></li>
      <li class="list-inline-item"><a href="/pages/acerca-de.html">Acerca de David Francos</a></li>
      <li class="list-inline-item"><a href="/pages/contacto.html">Contacto</a></li>
    </ul>
   </div>
</div>
</div>  </header>

  <div class="main">
    <div class="container">
      <h1>  Librería de la semana - Pavlova
</h1>
  <article class="article">
    <div class="content">
      <p>Con la salida de python3.7, hemos visto la inclusion de las <strong>dataclasses</strong> en
la libreria standard.</p>
<p>¿Que es eso de las dataclasses? En este articulo, haremos un repaso muy rápido
de las dataclasses como introducción a una librería de deserialización a
dataclasses en python, <strong>pavlova</strong>.</p>
<div class="line-block">
<div class="line"><br/></div>
</div>
<p class="alert alert-primary">META: este es el primer articulo de una serie de articulos sobre librerías que
encuentro interesantes en python, no incluidas en la libreria standard</p>
<div class="line-block">
<div class="line"><br/></div>
</div>
<div class="row"><div class="col-md-6"><p>Las dataclasses son una forma ordenada, simple y pythonica de implementar clases
que trabajen con datos, al estilo modelos.</p>
<p>Nos permiten:</p>
<ul class="simple">
<li>Crear objetos con un modelo de datos especifico</li>
<li>Especificar tipos (aunque <strong>no validan</strong>)</li>
<li>Transformar como diccionario</li>
<li>Ver una representación del objeto con mucho estilo</li>
</ul>
</div>
<div class="col-md-6"><div style="width:100%;height:0;padding-bottom:100%;position:relative;"><iframe allowfullscreen="" class="giphy-embed" frameborder="0" height="100%" src="https://giphy.com/embed/11DRQ1VQ5p5iPm" style="position:absolute" width="100%"></iframe></div><p><a href="https://giphy.com/gifs/swag-the-office-michael-scott-11DRQ1VQ5p5iPm">via GIPHY</a></p>
</div><div class="section" id="usando-dataclasses">
<h2>Usando dataclasses</h2>
<p>Como mejor vamos a ver esto, es con un ejemplo en código. para usarlas,
simplemente usaremos el decorador dataclass, y <a class="reference external" href="https://www.python.org/dev/peps/pep-0484/">type hinting</a>.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MyDataClass</span><span class="p">:</span>
    <span class="sd">"""Simple dataclass with two elements.</span>

<span class="sd">    This will receive two *mandatory* arguments, elem and number.</span>
<span class="sd">    """</span>
    <span class="n">elem</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<div class="section" id="inconvenientes-de-las-dataclasses">
<h2>Inconvenientes de las dataclasses</h2>
<p>Las dataclasses tienen <strong>dos inconvenientes</strong> para algunos casos de uso:</p>
<ul class="simple">
<li>No hace validación de tipos</li>
<li>No hay una forma comoda de cargarlas desde un diccionario</li>
</ul>
<p>Para cargarlas desde un diccionario, podemos por ejemplo, utilizar
desempaquetado para cargarlas</p>
<div class="highlight"><pre><span></span><span class="c1"># Usando la dataclass definida mas arriba</span>
<span class="n">mydict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">MyDataClass</span><span class="p">(</span><span class="o">**</span><span class="n">mydict</span><span class="p">)</span>
</pre></div>
<p>Sin embargo, esto no soporta dataclasses anidadas.</p>
<p>Vamos, que si tenemos una dataclass como argumento a otra dataclass, al cargar
los datos de un diccionario con otro diccionario dentro, nos vamos a quedar
con... <strong>un diccionario dentro de la dataclass</strong>.</p>
<p>Vamos a ilustrarlo con codigo. Si tenemos un par de dataclases, una como
argumento a la otra:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MyDataClass</span><span class="p">:</span>
    <span class="sd">"""Simple dataclass with two elements.</span>

<span class="sd">    This will receive two *mandatory* arguments, elem and number.</span>
<span class="sd">    """</span>
    <span class="n">elem</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">number</span><span class="p">:</span> <span class="nb">int</span>

 <span class="nd">@dataclass</span>
 <span class="k">class</span> <span class="nc">Inheritance</span><span class="p">:</span>
    <span class="n">inherit</span><span class="p">:</span> <span class="n">MyDataClass</span>
</pre></div>
<p>Y tenemos un diccionario tal que:</p>
<div class="highlight"><pre><span></span><span class="n">testdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'inherit'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'elem'</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">,</span> <span class="s1">'number'</span><span class="p">:</span> <span class="s1">'b'</span><span class="p">}}</span>
</pre></div>
<p>Cuando intentamos cargar asi el diccionario:</p>
<div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">Inheritance</span><span class="p">(</span><span class="o">**</span><span class="n">testdict</span><span class="p">)</span>
</pre></div>
<p>Veremos que <tt class="docutils literal">result.inherit</tt>, contiene <em>un diccionario</em>.
No nos ha cargado inherit como dataclass del tipo <em>MyDataClass</em>.</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">inherit</span><span class="p">)</span>
<span class="c1"># {'elem': 'a', 'number': 'b'}</span>
</pre></div>
<p>Esto es una consecuencia de que los type hints en las dataclases son solo
<em>ilustrativos</em>. No se utilizan por debajo. De este modo, podemos cargar tambien
strings en un campo con tipo entero o vice-versa. Las dataclasses no van a hacer
transformación ni validación de datos</p>
<p>Ahora, es cuando entra Pavlova al rescate. Que, usando el type hint con el que
le especificamos los tipos hará una conversión automatica del dato para cargarlo.</p>
</div>
<div class="section" id="pavlova">
<h2>Pavlova</h2>
<p>Pavlova se encarga de deserializar a dataclasses, permitiendonos solucionar
todos los problemas de los que hemos hablado (que no haya validación de tipos y
no podamos cargarlas comodamente desde un diccionario).</p>
<div class="section" id="deserializacion-de-clases-anidadas">
<h3>Deserializacion de clases anidadas</h3>
<p>Vamos a empezar probando, con Pavlova, la deserializacion de clases anidadas.
Vamos a reutilizar el código que teniamos anteriormente.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pavlova</span> <span class="kn">import</span> <span class="n">Pavlova</span>
<span class="n">with_pavlova</span> <span class="o">=</span> <span class="n">Pavlova</span><span class="p">()</span><span class="o">.</span><span class="n">from_mapping</span><span class="p">(</span><span class="n">testdict</span><span class="p">,</span> <span class="n">Inheritance</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">with_pavlova</span><span class="p">)</span>
</pre></div>
<p>Podemos ver que el resultado que nos da es:</p>
<div class="highlight"><pre><span></span><span class="n">Inheritance</span><span class="p">(</span><span class="n">inherit</span><span class="o">=</span><span class="n">MyDataClass</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
<img alt="Exito!" class="img-fluid" src="/images/success.gif"/>
<p class="alert alert-info">¡Pavlova soluciona nuestro primer problema!</p>
<p>Esto lo podemos aplicar a casting de cualquier tipo de dato, e incluso crear
nuestros propios conversores.</p>
<p>Como hemos podido ver que pavlova hace conversión de tipos utilizando los
valores provistos en el type hinting, podemos asumir que nos va a permitir
realizar ciertas validaciones de tipos basicas.</p>
<p>Incluso, mediante la implementación de nuestros propios tipos de datos,
podremos hacer validadores personalizados</p>
</div>
<div class="section" id="comprobacion-de-tipos">
<h3>Comprobación de tipos</h3>
<p>Vamos a comprobar la validación de tipos rapidamente.
Pavlova va a intentar <strong>convertir</strong> el tipo de dato de entrada al que le
hayamos especificado en la dataclass como <em>type hint</em>.</p>
<p>Podemos comprobar la validación de datos, por ejemplo, haciendo una conversion
inviable.</p>
<p>Vamos a probar, por ejemplo, a pasar como "number", un valor invalido, como
"foobar"</p>
<div class="highlight"><pre><span></span><span class="n">Pavlova</span><span class="p">()</span><span class="o">.</span><span class="n">from_mapping</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">elem</span><span class="o">=</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="s1">'foo'</span><span class="p">),</span> <span class="n">MyDataClass</span><span class="p">)</span>
<span class="c1"># PavlovaParsingError: invalid literal for int() with base 10: 'foo'</span>
</pre></div>
</div>
</div>
</div>
    </div>
  </article>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function() {
      // this.page.url = 'davidfrancos.net/dataclasses.html';
      this.page.identifier = 'dataclasses';
    };
    (function() {
      var d = document;
      var s = d.createElement('script');
      s.src = '//david-francos.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript class="text-muted">
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<footer class="content-info">
  <div class=container style="text-align:center; margin-bottom:20px; padding-top:10px">
     <a style="margin-right:40px" target=_blank href="http://linkedin.com/in/davidfrancos/"><i style="font-size:4em;" title="linkedin" class="fa fa-linkedin" aria-hidden="true"></i></a>
     <a style="margin-right:40px" target=_blank href="http://github.com/xayon/"><i style="font-size:4em;" class="fa fa-github" title="github" aria-hidden="true"></i></a>
     <a  target=_blank title="gratipay" href="https://gratipay.com/~XayOn/"><i style="font-size:4em;" class="fa fa-gratipay" aria-hidden="true"></i></a>
     <!-- Begin Mailchimp Signup Form -->
     <br/>
     <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
     <style type="text/css">
     	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
     </style>
     <div id="mc_embed_signup">
     <form action="https://davidfrancos.us20.list-manage.com/subscribe/post?u=2b9d1c0b5a4774f3f5af56a15&amp;id=c6f9c1b981" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
         <div id="mc_embed_signup_scroll">

     	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
         <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
         <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2b9d1c0b5a4774f3f5af56a15_c6f9c1b981" tabindex="-1" value=""></div>
         <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
         </div>
     </form>
     </div>
  </div>
</footer>    </div>
  </footer>
</body>

</html>